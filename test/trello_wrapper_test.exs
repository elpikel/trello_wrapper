defmodule TrelloWrapperTest do
  use ExUnit.Case

  test "should get boards" do
    assert Board.get_boards("arkadiuszplichta", &boards_downloader/1) == [%Board{dateLastActivity: "2017-08-10T13:47:41.820Z", id: "56d55636c3a8db40b95befb1", name: "Android - TestCases Contractor Mobile", number_of_cards: 1}, %Board{dateLastActivity: "2017-08-10T13:47:41.820Z", id: "54f4706ff5bc693f02a1232f", name: "Azure migration", number_of_cards: 1}, %Board{dateLastActivity: "2017-08-10T13:47:41.820Z", id: "59970555c69e4f917a4f2dbf", name: "Bugs & features", number_of_cards: 1}, %Board{dateLastActivity: "2017-08-10T13:47:41.820Z", id: "584fcaa5b76f4106a82cd12b", name: "CFO", number_of_cards: 1}, %Board{dateLastActivity: "2017-08-10T13:47:41.820Z", id: "5193f66ed4b879c37e00085b", name: "Defii.co - development", number_of_cards: 1}, %Board{dateLastActivity: "2017-08-10T13:47:41.820Z", id: "52279252b148cfc72f000443", name: "Defii.co - investors, meetups", number_of_cards: 1}]
  end

  test "should get cards" do
    assert Card.get_cards("zFmWPPv5", &cards_downloader/1) == [%Card{dateLastActivity: "2017-08-24 13:07:00.686280Z", id: "52f91f62b28a0496314ea8bd", members: [%Member{fullName: "Piotr Kosiński"}, %Member{fullName: "Arkadiusz Plichta"}, %Member{fullName: "pawel"}], name: ""}, %Card{dateLastActivity: "2017-08-24 13:07:00.686280Z", id: "511387b316d0567a3800dc94", members: [%Member{fullName: "Piotr Kosiński"}, %Member{fullName: "Arkadiusz Plichta"}, %Member{fullName: "pawel"}], name: ""}, %Card{dateLastActivity: "2017-08-24 13:07:00.686280Z", id: "554c528b53fd54274c70784e", members: [%Member{fullName: "Piotr Kosiński"}, %Member{fullName: "Arkadiusz Plichta"}, %Member{fullName: "pawel"}], name: ""}]
  end

  defp boards_downloader("https://api.trello.com/1/members/arkadiuszplichta/boards?" <> _rest) do
    """
    [{"name":"Android - TestCases Contractor Mobile","desc":"","descData":null,"closed":true,"idOrganization":null,"limits":null,"pinned":null,"invitations":null,"shortLink":"V1YmVtfr","powerUps":[],"dateLastActivity":"2016-04-12T07:12:50.311Z","idTags":[],"datePluginDisable":null,"id":"56d55636c3a8db40b95befb1","invited":false,"starred":false,"url":"https://trello.com/b/V1YmVtfr/android-testcases-contractor-mobile","prefs":{"permissionLevel":"private","voting":"disabled","comments":"members","invitations":"members","selfJoin":false,"cardCovers":true,"cardAging":"regular","calendarFeedEnabled":false,"background":"grey","backgroundImage":null,"backgroundImageScaled":null,"backgroundTile":false,"backgroundBrightness":"dark","backgroundColor":"#838C91","canBePublic":true,"canBeOrg":true,"canBePrivate":true,"canInvite":true},"subscribed":false,"labelNames":{"green":"Passes","yellow":"Firing WiFi settings with adb shell command works as interruption","orange":"Double Tap method is too slow, tests need to me manual","red":"Fails","purple":"Cannot be automated","blue":"Assertion needs to be implemented","sky":"","lime":"","pink":"Not tested yet","black":""},"dateLastView":"2016-06-23T12:20:07.894Z","shortUrl":"https://trello.com/b/V1YmVtfr","memberships":[{"id":"56d55636c3a8db40b95befb2","idMember":"56d55629db1fdcb1d92c9c45","memberType":"admin","unconfirmed":false,"deactivated":false},{"id":"56d562626dbe72327a7bd697","idMember":"511387b316d0567a3800dc94","memberType":"normal","unconfirmed":false,"deactivated":false},{"id":"56d7f6b0be7c0c7fd086d486","idMember":"5693c26f42152d6456626268","memberType":"normal","unconfirmed":false,"deactivated":false},{"id":"56e28dbe52db862f951b9f3e","idMember":"563b728f7f7a740248a13215","memberType":"normal","unconfirmed":false,"deactivated":false}]},{"name":"Azure migration","desc":"","descData":null,"closed":false,"idOrganization":null,"limits":null,"pinned":null,"invitations":null,"shortLink":"5BraZ9vX","powerUps":[],"dateLastActivity":"2015-03-03T16:49:47.186Z","idTags":[],"datePluginDisable":null,"id":"54f4706ff5bc693f02a1232f","invited":false,"starred":false,"url":"https://trello.com/b/5BraZ9vX/azure-migration","prefs":{"permissionLevel":"private","voting":"disabled","comments":"members","invitations":"members","selfJoin":false,"cardCovers":true,"cardAging":"regular","calendarFeedEnabled":false,"background":"blue","backgroundImage":null,"backgroundImageScaled":null,"backgroundTile":false,"backgroundBrightness":"dark","backgroundColor":"#0079BF","canBePublic":true,"canBeOrg":true,"canBePrivate":true,"canInvite":true},"subscribed":false,"labelNames":{"green":"","yellow":"","orange":"","red":"","purple":"","blue":"","sky":"","lime":"","pink":"","black":""},"dateLastView":"2016-03-29T13:23:40.622Z","shortUrl":"https://trello.com/b/5BraZ9vX","memberships":[{"id":"54f4706ff5bc693f02a12330","idMember":"511387b316d0567a3800dc94","memberType":"admin","unconfirmed":false,"deactivated":false}]},{"name":"Bugs & features","desc":"","descData":null,"closed":false,"idOrganization":"5997049395cd1db3230fddf0","limits":null,"pinned":null,"invitations":null,"shortLink":"zFmWPPv5","powerUps":[],"dateLastActivity":"2017-08-24T11:52:18.890Z","idTags":[],"datePluginDisable":null,"id":"59970555c69e4f917a4f2dbf","invited":false,"starred":false,"url":"https://trello.com/b/zFmWPPv5/bugs-features","prefs":{"permissionLevel":"org","voting":"disabled","comments":"members","invitations":"members","selfJoin":true,"cardCovers":true,"cardAging":"regular","calendarFeedEnabled":false,"background":"pink","backgroundImage":null,"backgroundImageScaled":null,"backgroundTile":false,"backgroundBrightness":"dark","backgroundColor":"#CD5A91","canBePublic":true,"canBeOrg":true,"canBePrivate":true,"canInvite":true},"subscribed":false,"labelNames":{"green":"","yellow":"","orange":"","red":"","purple":"","blue":"","sky":"","lime":"","pink":"","black":""},"dateLastView":"2017-08-24T12:14:57.733Z","shortUrl":"https://trello.com/b/zFmWPPv5","memberships":[{"id":"59970555c69e4f917a4f2dc0","idMember":"52f91f62b28a0496314ea8bd","memberType":"admin","unconfirmed":false,"deactivated":false},{"id":"5997eafb24d05738bb25e42c","idMember":"511387b316d0567a3800dc94","memberType":"normal","unconfirmed":false,"deactivated":false},{"id":"5997eb013a14784eb5af61c1","idMember":"554c528b53fd54274c70784e","memberType":"normal","unconfirmed":false,"deactivated":false},{"id":"5997f079846d189a8c58bdd0","idMember":"592e7b20a30913fc0d03abfa","memberType":"normal","unconfirmed":false,"deactivated":false},{"id":"599850f99e24bf792a4c7f53","idMember":"554caec7857d93c64b1c5f7e","memberType":"normal","unconfirmed":false,"deactivated":false},{"id":"599850f90cf5090f8f22f424","idMember":"5998321d9def590fcc43c263","memberType":"normal","unconfirmed":false,"deactivated":false}]},{"name":"CFO","desc":"","descData":null,"closed":false,"idOrganization":null,"limits":null,"pinned":null,"invitations":null,"shortLink":"CrbDSaPY","powerUps":[],"dateLastActivity":"2016-12-13T15:29:54.486Z","idTags":[],"datePluginDisable":null,"id":"584fcaa5b76f4106a82cd12b","invited":false,"starred":false,"url":"https://trello.com/b/CrbDSaPY/cfo","prefs":{"permissionLevel":"private","voting":"disabled","comments":"members","invitations":"members","selfJoin":false,"cardCovers":true,"cardAging":"regular","calendarFeedEnabled":false,"background":"blue","backgroundImage":null,"backgroundImageScaled":null,"backgroundTile":false,"backgroundBrightness":"dark","backgroundColor":"#0079BF","canBePublic":true,"canBeOrg":true,"canBePrivate":true,"canInvite":true},"subscribed":false,"labelNames":{"green":"","yellow":"","orange":"","red":"","purple":"","blue":"","sky":"","lime":"","pink":"","black":""},"dateLastView":"2016-12-14T08:20:26.590Z","shortUrl":"https://trello.com/b/CrbDSaPY","memberships":[{"id":"584fcaa5b76f4106a82cd12c","idMember":"511387b316d0567a3800dc94","memberType":"admin","unconfirmed":false,"deactivated":false}]},{"name":"Defii.co - development","desc":"","descData":null,"closed":true,"idOrganization":null,"limits":null,"pinned":null,"invitations":null,"shortLink":"8RNNCFw9","powerUps":[],"dateLastActivity":"2013-11-28T19:36:59.472Z","idTags":[],"datePluginDisable":null,"id":"5193f66ed4b879c37e00085b","invited":false,"starred":false,"url":"https://trello.com/b/8RNNCFw9/defiico-development","prefs":{"permissionLevel":"private","voting":"disabled","comments":"members","invitations":"members","selfJoin":false,"cardCovers":true,"calendarFeedEnabled":false,"background":"blue","backgroundImage":null,"backgroundImageScaled":null,"backgroundTile":false,"backgroundBrightness":"dark","backgroundColor":"#0079BF","canBePublic":true,"canBeOrg":true,"canBePrivate":true,"canInvite":true},"subscribed":false,"labelNames":{"green":"","yellow":"","orange":"","red":"Critical","purple":"","blue":"","sky":"","lime":"","pink":"","black":""},"dateLastView":"2014-02-04T09:47:49.424Z","shortUrl":"https://trello.com/b/8RNNCFw9","memberships":[{"id":"5193f66ed4b879c37e00085f","idMember":"4f0ca7f3923b1a28772f60bb","memberType":"admin","unconfirmed":false,"deactivated":false},{"id":"5193f6770459e490780008db","idMember":"4e77b09a6d57e9000035a401","memberType":"admin","unconfirmed":false,"deactivated":false},{"id":"51a9476a2487c5896a0008c7","idMember":"511387b316d0567a3800dc94","memberType":"admin","unconfirmed":false,"deactivated":false},{"id":"51eed4a05f427c1c09003fe9","idMember":"51eed49f5f427c1c09003f8d","memberType":"normal","unconfirmed":false,"deactivated":false}]},{"name":"Defii.co - investors, meetups","desc":"","descData":null,"closed":true,"idOrganization":null,"limits":null,"pinned":null,"invitations":null,"shortLink":"gsAkYd4w","powerUps":[],"dateLastActivity":"2013-10-07T22:52:12.161Z","idTags":[],"datePluginDisable":null,"id":"52279252b148cfc72f000443","invited":false,"starred":false,"url":"https://trello.com/b/gsAkYd4w/defiico-investors-meetups","prefs":{"permissionLevel":"private","voting":"disabled","comments":"members","invitations":"members","selfJoin":false,"cardCovers":true,"cardAging":"regular","calendarFeedEnabled":false,"background":"blue","backgroundImage":null,"backgroundImageScaled":null,"backgroundTile":false,"backgroundBrightness":"dark","backgroundColor":"#0079BF","canBePublic":true,"canBeOrg":true,"canBePrivate":true,"canInvite":true},"subscribed":false,"labelNames":{"green":"","yellow":"","orange":"","red":"","purple":"","blue":"","sky":"","lime":"","pink":"","black":""},"dateLastView":"2014-01-25T20:57:04.264Z","shortUrl":"https://trello.com/b/gsAkYd4w","memberships":[{"id":"52279252b148cfc72f000447","idMember":"4f0ca7f3923b1a28772f60bb","memberType":"admin","unconfirmed":false,"deactivated":false},{"id":"52279291b96b286f0f000871","idMember":"4e77b09a6d57e9000035a401","memberType":"normal","unconfirmed":false,"deactivated":false},{"id":"52279294de25748c3300091c","idMember":"511387b316d0567a3800dc94","memberType":"normal","unconfirmed":false,"deactivated":false}]}]
    """
  end

  defp boards_downloader(_url_of_card) do
    """
    [{"id":"598c63fd0894f438267a0290","checkItemStates":null,"closed":false,"dateLastActivity":"2017-08-10T13:47:41.820Z","desc":"","descData":null,"idBoard":"598c63ed198c1071a0b685a7","idList":"598c63f7434a295ddd236a5b","idMembersVoted":[],"idShort":1,"idAttachmentCover":null,"limits":{"attachments.perCard":{"status":"ok","disableAt":950,"warnAt":900},"checklists.perCard":{"status":"ok","disableAt":475,"warnAt":450},"stickers.perCard":{"status":"ok","disableAt":66.5,"warnAt":63}},"idLabels":[],"manualCoverAttachment":false,"name":"Setup repo","pos":65535,"shortLink":"AeDYWMFH","badges":{"votes":0,"attachmentsByType":{"trello":{"board":0,"card":0}},"viewingMemberVoted":false,"subscribed":false,"fogbugz":"","checkItems":0,"checkItemsChecked":0,"comments":0,"attachments":0,"description":false,"due":null,"dueComplete":false},"dueComplete":false,"due":null,"idChecklists":[],"idMembers":[],"labels":[],"shortUrl":"https://trello.com/c/AeDYWMFH","subscribed":false,"url":"https://trello.com/c/AeDYWMFH/1-setup-repo"}]
    """
  end

  defp cards_downloader("https://api.trello.com/1/members/zFmWPPv5/boards?" <> _rest) do
    """
    [{"id":"5997ea1d21c03b8ee761943d","checkItemStates":null,"closed":false,"dateLastActivity":"2017-08-19T07:35:38.506Z","desc":"","descData":null,"idBoard":"59970555c69e4f917a4f2dbf","idList":"5997055c195b129c6541eb1e","idMembersVoted":[],"idShort":2,"idAttachmentCover":"5997ea24a54d603ccfe27f76","limits":{"attachments.perCard":{"status":"ok","disableAt":950,"warnAt":900},"checklists.perCard":{"status":"ok","disableAt":475,"warnAt":450},"stickers.perCard":{"status":"ok","disableAt":66.5,"warnAt":63}},"idLabels":[],"manualCoverAttachment":false,"name":"Błędy z połączeniami SignalR","pos":131071,"shortLink":"HV9Dpeon","badges":{"votes":0,"attachmentsByType":{"trello":{"board":0,"card":0}},"viewingMemberVoted":false,"subscribed":false,"fogbugz":"","checkItems":0,"checkItemsChecked":0,"comments":1,"attachments":1,"description":false,"due":null,"dueComplete":false},"dueComplete":false,"due":null,"idChecklists":[],"idMembers":[],"labels":[],"shortUrl":"https://trello.com/c/HV9Dpeon","subscribed":false,"url":"https://trello.com/c/HV9Dpeon/2-b%C5%82%C4%99dy-z-po%C5%82%C4%85czeniami-signalr"},{"id":"5997eaddd684316a29b5e993","checkItemStates":null,"closed":false,"dateLastActivity":"2017-08-19T08:06:41.395Z","desc":"","descData":null,"idBoard":"59970555c69e4f917a4f2dbf","idList":"5997055c195b129c6541eb1e","idMembersVoted":[],"idShort":3,"idAttachmentCover":null,"limits":{"attachments.perCard":{"status":"ok","disableAt":950,"warnAt":900},"checklists.perCard":{"status":"ok","disableAt":475,"warnAt":450},"stickers.perCard":{"status":"ok","disableAt":66.5,"warnAt":63}},"idLabels":[],"manualCoverAttachment":false,"name":"Film instruktażowy","pos":196607,"shortLink":"ZDvXAdt3","badges":{"votes":0,"attachmentsByType":{"trello":{"board":0,"card":0}},"viewingMemberVoted":false,"subscribed":false,"fogbugz":"","checkItems":0,"checkItemsChecked":0,"comments":2,"attachments":1,"description":false,"due":null,"dueComplete":false},"dueComplete":false,"due":null,"idChecklists":[],"idMembers":[],"labels":[],"shortUrl":"https://trello.com/c/ZDvXAdt3","subscribed":false,"url":"https://trello.com/c/ZDvXAdt3/3-film-instrukta%C5%BCowy"},{"id":"5997eb1e5d958492edb5df03","checkItemStates":null,"closed":false,"dateLastActivity":"2017-08-19T07:39:41.151Z","desc":"14 sekund sama fotografia/selfie na pełny ekran\n14 sekund, jak dzisiaj, czyli proporcjonalne zmniejszona foty i podpis do 180 znaków max.\nPotem post ląduje, jako \"kafelek\" na tablicy","descData":{"emoji":{}},"idBoard":"59970555c69e4f917a4f2dbf","idList":"5997055c195b129c6541eb1e","idMembersVoted":[],"idShort":4,"idAttachmentCover":null,"limits":{"attachments.perCard":{"status":"ok","disableAt":950,"warnAt":900},"checklists.perCard":{"status":"ok","disableAt":475,"warnAt":450},"stickers.perCard":{"status":"ok","disableAt":66.5,"warnAt":63}},"idLabels":[],"manualCoverAttachment":false,"name":"Zmiana wyświetlania wiadomości na tablicy","pos":262143,"shortLink":"47AZeh2H","badges":{"votes":0,"attachmentsByType":{"trello":{"board":0,"card":0}},"viewingMemberVoted":false,"subscribed":false,"fogbugz":"","checkItems":0,"checkItemsChecked":0,"comments":0,"attachments":0,"description":true,"due":null,"dueComplete":false},"dueComplete":false,"due":null,"idChecklists":[],"idMembers":[],"labels":[],"shortUrl":"https://trello.com/c/47AZeh2H","subscribed":false,"url":"https://trello.com/c/47AZeh2H/4-zmiana-wy%C5%9Bwietlania-wiadomo%C5%9Bci-na-tablicy"},{"id":"5997057a16aa5bfe4189097e","checkItemStates":null,"closed":false,"dateLastActivity":"2017-08-24T11:52:18.890Z","desc":"","descData":null,"idBoard":"59970555c69e4f917a4f2dbf","idList":"5997056182a57a3bb91ff466","idMembersVoted":[],"idShort":1,"idAttachmentCover":null,"limits":{"attachments.perCard":{"status":"ok","disableAt":950,"warnAt":900},"checklists.perCard":{"status":"ok","disableAt":475,"warnAt":450},"stickers.perCard":{"status":"ok","disableAt":66.5,"warnAt":63}},"idLabels":[],"manualCoverAttachment":false,"name":"Limit 180 znaków","pos":65535,"shortLink":"HDS0uenB","badges":{"votes":0,"attachmentsByType":{"trello":{"board":0,"card":0}},"viewingMemberVoted":false,"subscribed":true,"fogbugz":"","checkItems":3,"checkItemsChecked":2,"comments":1,"attachments":0,"description":false,"due":null,"dueComplete":false},"dueComplete":false,"due":null,"idChecklists":["5997058381866a9246e115b0"],"idMembers":["52f91f62b28a0496314ea8bd","511387b316d0567a3800dc94","554c528b53fd54274c70784e"],"labels":[],"shortUrl":"https://trello.com/c/HDS0uenB","subscribed":true,"url":"https://trello.com/c/HDS0uenB/1-limit-180-znak%C3%B3w"}]
    """
  end

  defp cards_downloader(_url) do
    """
    [{"id":"52f91f62b28a0496314ea8bd","avatarHash":"1bc0384f371fef333f0a6a9cebb205f4","fullName":"Piotr Kosiński","initials":"PK","username":"piotrkosinski"},{"id":"511387b316d0567a3800dc94","avatarHash":"3f645cfeee7dd963365fdc497576d57a","fullName":"Arkadiusz Plichta","initials":"AP","username":"arkadiuszplichta"},{"id":"554c528b53fd54274c70784e","avatarHash":null,"fullName":"pawel","initials":"P","username":"pawel213"}]
    """
  end
end
